<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1510px" preserveAspectRatio="none" style="width:1286px;height:1510px;" version="1.1" viewBox="0 0 1286 1510" width="1286px" zoomAndPan="magnify"><defs><filter height="300%" id="f6uueuf90q7x0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="702" x="295.5" y="17.3519">REQUEST_TIMEOUT and REQUEST_NACK PCT events state machine in the retry handler</text><ellipse cx="1000" cy="40.6259" fill="#000000" filter="url(#f6uueuf90q7x0)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="834" y="128.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="834" x2="928" y1="156.2238" y2="156.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="844" y="147.1218">spt_timeout</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="1082" y="128.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1082" x2="1158" y1="156.2238" y2="156.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="1092" y="147.1218">spt_nack</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="174" y="256.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="334" y1="284.2238" y2="284.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="184" y="275.1218">spt_restricted_timeout</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="1048.5" y="256.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1048.5" x2="1191.5" y1="284.2238" y2="284.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="1058.5" y="275.1218">new_status_for_spt</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="7.5" y="1076.1259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7.5" x2="120.5" y1="1103.7238" y2="1103.7238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="17.5" y="1094.6218">cancel_request</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="152" y="367.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="152" x2="356" y1="395.2238" y2="395.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="184" x="162" y="386.1218">schedule_retry_restricted_pkt</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="52.682" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="1071.5" y="447.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1071.5" x2="1238.5" y1="475.2238" y2="475.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="1132" y="466.1218">get_sct</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="1076.5" y="491.7919">retrieve SCT and all its SPTs</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="52.682" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="614.5" y="1074.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="614.5" x2="739.5" y1="1102.2238" y2="1102.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="624.5" y="1093.1218">check_sct_status</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="95" x="619.5" y="1118.7919">check SPTs status</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="294" y="1207.1259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="294" x2="446" y1="1234.7238" y2="1234.7238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="304" y="1225.6218">add_check_sct_timer</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="52.682" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="674" y="1205.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="674" x2="826" y1="1233.2238" y2="1233.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="692" y="1224.1218">cancel_spt_entries</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="679" y="1249.7919">cancel all remaining SPTs</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="503" y="1207.1259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="503" x2="639" y1="1234.7238" y2="1234.7238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="513" y="1225.6218">schedule_retry_sct</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="865.5" y="1368.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="865.5" x2="940.5" y1="1396.2238" y2="1396.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="875.5" y="1387.1218">retry_sct</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="661" y="1368.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="661" x2="731" y1="1396.2238" y2="1396.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="671" y="1387.1218">free_sct</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="531" y="946.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="531" x2="667" y1="974.2238" y2="974.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="541" y="965.1218">timeout_check_sct</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="316" y="1368.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="316" x2="462" y1="1396.2238" y2="1396.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="326" y="1387.1218">add_sct_retry_timer</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="584.5" y="690.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="584.5" x2="661.5" y1="718.2238" y2="718.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="594.5" y="709.1218">retry_pkt</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="699" y="818.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="699" x2="859" y1="846.2238" y2="846.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="709" y="837.1218">add_sct_paused_timer</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="248.5" y="530.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="248.5" x2="391.5" y1="558.2238" y2="558.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="258.5" y="549.1218">retry_restricted_pkt</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="129" y="610.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="129" x2="249" y1="638.2238" y2="638.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="139" y="629.1218">add_retry_timer</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="154" y="946.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="154" x2="352" y1="974.2238" y2="974.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="178" x="164" y="965.1218">timeout_retry_restricted_pkt</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="550" y="818.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="550" x2="664" y1="846.2238" y2="846.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="560" y="837.1218">wait_for_event</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="373" y="818.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="373" x2="507" y1="846.2238" y2="846.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="383" y="837.1218">add_paused_timer</text><rect fill="#FEFECE" filter="url(#f6uueuf90q7x0)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="74" y="1288.6259"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="74" x2="164" y1="1316.2238" y2="1316.2238"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="84" y="1307.1218">release_spt</text><ellipse cx="148" cy="1489.6259" fill="none" filter="url(#f6uueuf90q7x0)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="148.5" cy="1490.1259" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><!--MD5=[b72731811802f588649939652bcc1b0d]
link *start to spt_timeout--><path d="M989.7898,42.4079 C962.948,47.3212 891.5354,61.9438 878,80.6259 C869.251,92.7016 869.1703,109.0813 871.6415,123.2654 " fill="none" id="*start-&gt;spt_timeout" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="872.656,128.3797,874.8281,118.7733,871.683,123.4752,866.9811,120.3301,872.656,128.3797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="879" y="94.1579">C_PCT_REQUEST_TIMEOUT event</text><!--MD5=[c475c1c572452df59adbe13baab6ad08]
link *start to spt_nack--><path d="M1009.8897,43.3302 C1026.4231,48.2833 1059.9327,60.2216 1081,80.6259 C1093.3333,92.5711 1102.65,109.2696 1109.0792,123.6816 " fill="none" id="*start-&gt;spt_nack" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1111.149,128.4713,1111.2507,118.6229,1109.1656,123.8815,1103.9071,121.7964,1111.149,128.4713" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="1097" y="94.1579">C_PCT_REQUEST_NACK event</text><!--MD5=[eba6b496864f935ad5b0ef7adf79080d]
link spt_timeout to spt_restricted_timeout--><path d="M833.8731,163.2467 C728.641,184.7295 473.2877,236.859 339.2981,264.2126 " fill="none" id="spt_timeout-&gt;spt_restricted_timeout" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="334.1902,265.2553,343.8084,267.3742,339.0892,264.2551,342.2082,259.5359,334.1902,265.2553" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="607" y="222.1579">SPT is restricted</text><!--MD5=[1222499dd47c4ed3d1915403f264af15]
link spt_timeout to new_status_for_spt--><path d="M919.8012,178.773 C942.9866,193.4081 973.2403,211.8288 1001,226.6259 C1019.145,236.298 1039.3036,245.9933 1057.7947,254.4907 " fill="none" id="spt_timeout-&gt;new_status_for_spt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1062.4577,256.6245,1055.9385,249.242,1057.9112,254.5438,1052.6094,256.5164,1062.4577,256.6245" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1002" y="222.1579">SPT is unrestricted</text><!--MD5=[31f964f2e7f4d194a55dc7e6cd9753ef]
link spt_nack to new_status_for_spt--><path d="M1120,178.9146 C1120,199.6893 1120,229.1809 1120,251.2368 " fill="none" id="spt_nack-&gt;new_status_for_spt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1120,256.3898,1124,247.3898,1120,251.3898,1116,247.3898,1120,256.3898" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d4e56d62d1079f3ef84da7ed3f8fc304]
link spt_restricted_timeout to cancel_request--><path d="M173.824,301.3011 C101.3672,321.494 6,355.1836 6,392.6259 C6,392.6259 6,392.6259 6,971.6259 C6,1008.42 25.743,1046.3615 42.1915,1071.5869 " fill="none" id="spt_restricted_timeout-&gt;cancel_request" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="45.0086,1075.8346,43.3674,1066.1234,42.2449,1071.6678,36.7006,1070.5453,45.0086,1075.8346" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="7" y="720.1579">SPT cannot be retried</text><!--MD5=[e1b51bd4a967f680102bc9a8775a2e53]
link spt_restricted_timeout to schedule_retry_restricted_pkt--><path d="M254,306.8135 C254,323.2763 254,344.872 254,362.2802 " fill="none" id="spt_restricted_timeout-&gt;schedule_retry_restricted_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="254,367.538,258,358.538,254,362.538,250,358.538,254,367.538" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7336f17dacaed4372b05a9ea4715e8d9]
link new_status_for_spt to get_sct--><path d="M1124.5756,306.7919 C1130.9065,341.6115 1142.336,404.4737 1149.2403,442.4475 " fill="none" id="new_status_for_spt-&gt;get_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1150.142,447.407,1152.4675,437.8366,1149.2476,442.4876,1144.5966,439.2677,1150.142,447.407" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[d5d6da3c765f6503fae44aa78775abba]
link get_sct to check_sct_status--><path d="M1164.1114,500.6272 C1174.1826,532.3305 1189,587.2027 1189,635.6259 C1189,635.6259 1189,635.6259 1189,971.6259 C1189,1062.2065 884.0033,1090.1071 744.8113,1098.1237 " fill="none" id="get_sct-&gt;check_sct_status" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="739.5251,1098.4232,748.737,1101.9076,744.5171,1098.1403,748.2844,1093.9204,739.5251,1098.4232" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[c1ae4c78e99613f1a2935237974943c4]
link check_sct_status to add_check_sct_timer--><path d="M614.4074,1109.9163 C549.9945,1119.8651 454.8357,1137.3502 424,1157.6259 C407.1635,1168.6966 393.8083,1186.9452 384.5914,1202.6103 " fill="none" id="check_sct_status-&gt;add_check_sct_timer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="382.102,1206.952,390.0487,1201.1339,384.589,1202.6144,383.1085,1197.1547,382.102,1206.952" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="425" y="1171.1579">not all SPTs status known</text><!--MD5=[f10667e1b3fdc35117de15414d3be8f4]
link check_sct_status to cancel_spt_entries--><path d="M693.4134,1127.6638 C699.1047,1137.0574 705.4475,1147.7456 711,1157.6259 C718.9038,1171.6903 727.2512,1187.4946 734.1864,1200.916 " fill="none" id="check_sct_status-&gt;cancel_spt_entries" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="736.4815,1205.3703,735.915,1195.5377,734.1914,1200.9256,728.8035,1199.2019,736.4815,1205.3703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="721" y="1171.1579">SPTs must be cancelled</text><!--MD5=[6747e948d76b7ca763197c5c48f1cc3a]
link check_sct_status to schedule_retry_sct--><path d="M621.3524,1127.7422 C609.1742,1135.8374 597.4221,1145.7925 589,1157.6259 C579.8606,1170.4672 575.3251,1187.3753 573.0898,1201.8374 " fill="none" id="check_sct_status-&gt;schedule_retry_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="572.3661,1207.0428,577.5677,1198.6795,573.0548,1202.0904,569.6439,1197.5776,572.3661,1207.0428" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="590" y="1171.1579">retrying some SPTs</text><!--MD5=[0eb492fcc3f9305a685d41c4532097ef]
link check_sct_status to retry_sct--><path d="M739.7918,1112.5766 C787.7383,1122.626 848.3285,1138.5888 865,1157.6259 C915.7811,1215.6124 912.8793,1313.6831 907.4605,1363.1517 " fill="none" id="check_sct_status-&gt;retry_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="906.8606,1368.3613,911.8642,1359.8781,907.4327,1363.3941,903.9167,1358.9627,906.8606,1368.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="908" y="1236.6579">SCT retry timer had expired</text><!--MD5=[4d99783585c75ea44380f5ed4a991387]
link cancel_spt_entries to free_sct--><path d="M741.083,1258.7943 C731.4549,1287.5894 716.1492,1333.365 706.0881,1363.455 " fill="none" id="cancel_spt_entries-&gt;free_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="704.3967,1368.5134,711.0443,1361.2464,705.9823,1363.7714,703.4572,1358.7094,704.3967,1368.5134" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[2452be987cbb07b4bb1cc3c3959e0888]
link add_check_sct_timer to timeout_check_sct--><path d="M377.7513,1206.9816 C382.7135,1192.2244 389.7589,1173.4308 398,1157.6259 C418.6901,1117.9461 423.661,1106.5702 455,1074.6259 C483.8256,1045.2435 521.8973,1018.4166 551.654,999.5117 " fill="none" id="add_check_sct_timer-&gt;timeout_check_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="555.982,996.7806,546.2361,998.2008,551.7535,999.4489,550.5055,1004.9664,555.982,996.7806" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="456" y="1105.6579">check SCT timer expired</text><!--MD5=[2d8ede9942a138896b2c318b6a27a91d]
link timeout_check_sct to check_sct_status--><path d="M614.2244,996.9022 C626.8598,1017.8803 644.8794,1047.7974 658.374,1070.2019 " fill="none" id="timeout_check_sct-&gt;check_sct_status" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="661.0096,1074.5778,659.7926,1064.8044,658.4299,1070.2946,652.9396,1068.9319,661.0096,1074.5778" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[af85598503a3bdc0e990dcad376ab54b]
link schedule_retry_sct to retry_sct--><path d="M620.8177,1257.1637 C664.3027,1278.9323 729.1665,1311.195 786,1338.6259 C810.7214,1350.5578 838.5254,1363.6419 860.8244,1374.054 " fill="none" id="schedule_retry_sct-&gt;retry_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="865.4961,1376.2339,859.0317,1368.8034,860.9651,1374.1196,855.6489,1376.0529,865.4961,1376.2339" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="787" y="1318.1579">nb retries == 0</text><!--MD5=[afd80a42d99143c42318b6702ad9b222]
link schedule_retry_sct to add_sct_retry_timer--><path d="M518.4192,1257.2215 C502.6537,1266.0037 485.8791,1276.6904 472,1288.6259 C446.3987,1310.6419 423.1188,1341.4952 407.7736,1364.0596 " fill="none" id="schedule_retry_sct-&gt;add_sct_retry_timer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="404.812,1368.4569,413.1573,1363.2266,407.6051,1364.3098,406.5219,1358.7576,404.812,1368.4569" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="473" y="1318.1579">nb retries &gt; 0</text><!--MD5=[4ce131af6c80d3883cfc8a153d8d5a83]
link retry_sct to retry_pkt--><path d="M940.9428,1383.9262 C1002.665,1365.6049 1118,1319.6585 1118,1232.1259 C1118,843.6259 1118,843.6259 1118,843.6259 C1118,750.9141 788.4059,724.2785 667.1115,717.6154 " fill="none" id="retry_sct-&gt;retry_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="661.8418,717.3313,670.6133,721.8102,666.8345,717.6005,671.0442,713.8218,661.8418,717.3313" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b5310fd843912129cfa99f83d5af0e1e]
link add_sct_retry_timer to timeout_check_sct--><path d="M353.1049,1368.3054 C296.7048,1325.2824 198.2447,1235.0391 244,1157.6259 C304.1383,1055.8783 440.7695,1007.2648 525.9034,986.0702 " fill="none" id="add_sct_retry_timer-&gt;timeout_check_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="530.9288,984.8361,521.2345,983.0981,526.0731,986.0286,523.1426,990.8672,530.9288,984.8361" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="245" y="1171.1579">SCT retry timer expired</text><!--MD5=[ffced8679acbe481653f68474da29498]
link add_sct_paused_timer to timeout_check_sct--><path d="M743.4378,868.9146 C713.1392,890.4602 669.6557,921.3818 638.3258,943.6609 " fill="none" id="add_sct_paused_timer-&gt;timeout_check_sct" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="634.1816,946.6078,643.8343,944.6518,638.2564,943.7101,639.1981,938.1322,634.1816,946.6078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="701" y="912.1579">SCT paused timer expired</text><!--MD5=[99e805eee789c86de572de00baac8d50]
link schedule_retry_restricted_pkt to retry_restricted_pkt--><path d="M264.1679,417.7374 C275.9407,446.8127 295.3177,494.6681 307.8673,525.6618 " fill="none" id="schedule_retry_restricted_pkt-&gt;retry_restricted_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="309.8206,530.4858,310.1504,520.6424,307.9441,525.8513,302.7352,523.6449,309.8206,530.4858" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="298" y="478.6579">nb retries == 0</text><!--MD5=[979e4ebb1385518e4dbdaefb093859e5]
link schedule_retry_restricted_pkt to add_retry_timer--><path d="M214.1446,417.7614 C204.4543,425.9991 195.3493,436.0569 190,447.6259 C166.2713,498.9443 174.1969,566.8905 181.8032,605.4655 " fill="none" id="schedule_retry_restricted_pkt-&gt;add_retry_timer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="182.8229,610.4796,184.9491,600.8629,181.8265,605.5799,177.1096,602.4572,182.8229,610.4796" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="191" y="478.6579">nb retries &gt; 0</text><!--MD5=[23e0adcf5db5d02540e50ffa107a38b3]
link add_retry_timer to timeout_retry_restricted_pkt--><path d="M184.6442,660.7795 C180.1303,691.2986 174.7908,744.1868 183,788.6259 C193.4081,844.968 220.4237,906.3911 237.6869,941.8179 " fill="none" id="add_retry_timer-&gt;timeout_retry_restricted_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="239.9508,946.4296,239.5756,936.5878,237.7475,941.9412,232.3942,940.1131,239.9508,946.4296" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="184" y="784.1579">retry timer expired</text><!--MD5=[41ce8ce97c18af69e95d8e538798febc]
link timeout_retry_restricted_pkt to cancel_request--><path d="M153.8737,988.6918 C113.3128,997.8783 73.053,1010.6354 61,1026.6259 C51.6197,1039.0706 51.7255,1056.2868 54.4698,1071.0344 " fill="none" id="timeout_retry_restricted_pkt-&gt;cancel_request" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="55.4918,1075.9306,57.5683,1066.3031,54.4701,1071.0361,49.7371,1067.9378,55.4918,1075.9306" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="62" y="1040.1579">CQ is now closed</text><!--MD5=[b214ac85285daff15724da176ec1049e]
link timeout_retry_restricted_pkt to retry_restricted_pkt--><path d="M260.4509,946.4127 C270.5248,911.3478 288.338,845.7238 298,788.6259 C310.1818,716.6368 316.1016,630.909 318.5483,586.1998 " fill="none" id="timeout_retry_restricted_pkt-&gt;retry_restricted_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318.8297,580.9544,314.3533,589.7272,318.5618,585.9472,322.3418,590.1557,318.8297,580.9544" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[147db260c4f2d14bf45885752d5d0fd6]
link retry_restricted_pkt to retry_pkt--><path d="M367.6771,580.8019 C425.8714,611.5316 523.4453,663.0558 579.6176,692.7177 " fill="none" id="retry_restricted_pkt-&gt;retry_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="584.255,695.1665,578.1644,687.4267,579.8336,692.8316,574.4287,694.5009,584.255,695.1665" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e54be255c504a7bf22151e1656fb97d3]
link retry_pkt to wait_for_event--><path d="M619.8389,740.9146 C617.2421,761.6893 613.5556,791.1809 610.7986,813.2368 " fill="none" id="retry_pkt-&gt;wait_for_event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="610.1545,818.3898,615.2401,809.9555,610.7748,813.4284,607.3019,808.9631,610.1545,818.3898" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="617" y="784.1579">SPT retry posted</text><!--MD5=[d401f4595ecd694e9ff6158438dff9cc]
link retry_pkt to add_paused_timer--><path d="M584.2348,723.7304 C540.5258,733.6417 473.2816,751.4777 456,770.6259 C445.6256,782.1208 441.4468,798.7633 439.9415,813.2556 " fill="none" id="retry_pkt-&gt;add_paused_timer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="439.5014,818.4841,444.2425,809.8515,439.921,813.5017,436.2707,809.1801,439.5014,818.4841" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="457" y="784.1579">(restricted) PCP is paused</text><!--MD5=[6579435c9d47f9928872735ddd15ea62]
link retry_pkt to add_sct_paused_timer--><path d="M661.9244,732.3475 C681.4779,741.8636 704.8129,755.0051 723,770.6259 C737.4953,783.0758 750.6716,799.8303 760.5965,814.148 " fill="none" id="retry_pkt-&gt;add_sct_paused_timer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="763.5701,818.5057,761.8009,808.817,760.7517,814.3757,755.193,813.3264,763.5701,818.5057" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="742" y="784.1579">(unrestricted) PCP is paused</text><!--MD5=[d7553e350cfeb6e535cfd35d24e97e67]
link add_paused_timer to timeout_retry_restricted_pkt--><path d="M409.8245,868.6317 C391.7378,883.2182 368.0414,901.6374 346,916.6259 C332.2239,925.9939 316.8132,935.4815 302.5601,943.8782 " fill="none" id="add_paused_timer-&gt;timeout_retry_restricted_pkt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="298.177,946.4477,307.9641,945.3467,302.4904,943.9189,303.9182,938.4452,298.177,946.4477" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="371" y="912.1579">paused timer expired</text><!--MD5=[4fd19d87e605f5180833d69888a70fc6]
link cancel_request to release_spt--><path d="M70.5252,1126.3369 C80.697,1165.6369 100.2946,1241.3552 111.1979,1283.4816 " fill="none" id="cancel_request-&gt;release_spt" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="112.4833,1288.4477,114.1006,1278.7325,111.2305,1283.6072,106.3558,1280.737,112.4833,1288.4477" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[c0544029ebff52a8e9657f896cb9e32d]
link release_spt to *end--><path d="M123.155,1338.8424 C129.259,1375.8874 140.4665,1443.9052 145.4708,1474.2763 " fill="none" id="release_spt-&gt;*end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="146.3304,1479.4931,148.8138,1469.9624,145.5174,1474.5596,140.9202,1471.2632,146.3304,1479.4931" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[1eb6413465bf11f3736b12d5d9850d3b]
link free_sct to *end--><path d="M660.8865,1399.7772 C554.2895,1418.4511 237.2017,1473.9993 163.449,1486.9195 " fill="none" id="free_sct-&gt;*end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="158.1883,1487.8411,167.7436,1490.2279,163.1133,1486.9782,166.363,1482.3479,158.1883,1487.8411" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[32d4893fc153e53b76aaa74a3972589c]
@startuml

title REQUEST_TIMEOUT and REQUEST_NACK PCT events state machine in the retry handler

[*] - -> spt_timeout : C_PCT_REQUEST_TIMEOUT event
[*] - -> spt_nack : C_PCT_REQUEST_NACK event

spt_timeout - -> spt_restricted_timeout : SPT is restricted
spt_timeout - -> new_status_for_spt : SPT is unrestricted

spt_nack - -> new_status_for_spt

spt_restricted_timeout - -> cancel_request : SPT cannot be retried
spt_restricted_timeout - -> schedule_retry_restricted_pkt

new_status_for_spt - -> get_sct

get_sct - -> check_sct_status
get_sct : retrieve SCT and all its SPTs

check_sct_status : check SPTs status
check_sct_status - -> add_check_sct_timer : not all SPTs status known
check_sct_status - -> cancel_spt_entries : SPTs must be cancelled
check_sct_status - -> schedule_retry_sct : retrying some SPTs
check_sct_status - -> retry_sct : SCT retry timer had expired

cancel_spt_entries : cancel all remaining SPTs
cancel_spt_entries - -> free_sct

add_check_sct_timer - -> timeout_check_sct : check SCT timer expired
timeout_check_sct - -> check_sct_status

schedule_retry_sct - -> retry_sct : nb retries == 0
schedule_retry_sct - -> add_sct_retry_timer : nb retries > 0

retry_sct - -> retry_pkt

add_sct_retry_timer - -> timeout_check_sct : SCT retry timer expired

add_sct_paused_timer - -> timeout_check_sct : SCT paused timer expired

schedule_retry_restricted_pkt - -> retry_restricted_pkt : nb retries == 0
schedule_retry_restricted_pkt - -> add_retry_timer :  nb retries > 0

add_retry_timer - -> timeout_retry_restricted_pkt : retry timer expired

timeout_retry_restricted_pkt - -> cancel_request : CQ is now closed
timeout_retry_restricted_pkt - -> retry_restricted_pkt

retry_restricted_pkt - -> retry_pkt

retry_pkt - -> wait_for_event : SPT retry posted
retry_pkt - -> add_paused_timer : (restricted) PCP is paused
retry_pkt - -> add_sct_paused_timer : (unrestricted) PCP is paused

add_paused_timer - -> timeout_retry_restricted_pkt : paused timer expired

cancel_request - -> release_spt

release_spt - -> [*]

free_sct - -> [*]

@enduml

PlantUML version 1.2019.13(Tue Dec 10 11:18:29 CST 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_222-b10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>