.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "CXI_GPU_LOOPBACK_BW" "1" "2023-08-19" "Version 1.5.0" "CXI Diagnostics and Utilities"
.hy
.SH NAME
.PP
cxi_gpu_loopback_bw - Cassini with optional GPU loopback bandwidth
benchmark using LibCXI
.SH SYNOPSIS
.PP
\f[B]cxi_gpu_loopback_bw\f[R] [\f[I]OPTIONS\f[R]]
.SH DESCRIPTION
.PP
\f[B]cxi_gpu_loopback_bw\f[R] is a simple benchmark for measuring
loopback write bandwidth.
It can be configured to run some number of iterations or run for a
period of time.
Users have the option to allocate source and destination buffers from
system memory or from an available GPU device via calls to the HIP,
CUDA, or INTEL Level-zero APIs.
.SS How to run
.PP
Simply launch the executable on the node under test.
.SS Output
.PP
After the test is launched, a summary of the specified options is
printed.
After the benchmark runs, four columns of data are printed.
.TP
\f[I]RDMA Size[B]\f[R]
The RDMA transfer size in bytes.
.TP
\f[I]Writes\f[R]
The number of writes performed.
.TP
\f[I]BW[Gb/s]\f[R]
The measured bandwidth in gigabits per second.
.TP
\f[I]PktRate[Mpkt/s]\f[R]
The measured packet rate in millions of packets per second.
.SH OPTIONS
.TP
\f[B]-d, --device\f[R]=\f[I]DEV\f[R]
The Cassini NIC device name to use.
When unspecified, \[dq]cxi0\[dq] is used.
.TP
\f[B]-v, --svc-id\f[R]=\f[I]SVC_ID\f[R]
The service ID to use.
This option will be used when running as a non-privileged user.
When unspecified the default service ID is used.
.TP
\f[B]-t, --tx-gpu\f[R]
The GPU to use for TX buffer allocation.
By default system memory is used.
.TP
\f[B]-r, --rx-gpu\f[R]
The GPU to use for RX buffer allocation.
By default system memory is used.
.TP
\f[B]-g, --gpu-type\f[R]
The GPU type to use with this test.
Valid values are AMD, NVIDIA, or INTEL.
By default the type is determined by discovered GPU files on the system.
.TP
\f[B]-D, --duration\f[R]=\f[I]DURATION\f[R]
This option configures the benchmark to continue running iterations
until \f[I]DURATION\f[R] seconds has elapsed.
When a range of write sizes is specified, the benchmark runs for
\f[I]DURATION\f[R] seconds for each size.
.TP
\f[B]-i, --iters\f[R]=\f[I]ITERS\f[R]
The number of iterations to perform.
A single iteration consists of sending \f[I]NUM_XFERS\f[R] writes and
then waiting for a counting event to occur after all writes have
completed.
Default = 25 iterations.
.TP
\f[B]-s, --size\f[R]=\f[I]SIZE\f[R]
The transfer size in bytes.
Valid write sizes are 1 through 4294697295 bytes (4GiB - 1).
By default the write size is 524288 bytes.
.TP
\f[B]-n, --num-xfers\f[R]=\f[I]NUM_XFERS\f[R]
The number of writes performed per iteration.
The write commands are all added to the TX command queue before ringing
the queue\[cq]s doorbell to trigger the writes.
By default the number of transfers per iteration is 8192.
.TP
\f[B]--use-hp\f[R]=\f[I]HP_SIZE\f[R]
The size of huge pages to use when allocating the transmit and target
buffers.
This option has no effect when GPU buffers are used.
Valid values are 2M and 1G.
By default huge pages are disabled.
.TP
\f[B]-h, --help\f[R]
Display the help text and exit.
.TP
\f[B]-V, --version\f[R]
Display the program version and exit.
.SH EXAMPLES
.SS Example 1
.PP
Running with the default options (25 iterations of 8192 512KB transfers
using cxi0 with TX and RX system memory)
.IP
.nf
\f[C]
$ cxi_gpu_loopback_bw
---------------------------------------------------
    CXI Loopback Bandwidth Test
Device           : cxi0
Service ID       : 1
TX Mem           : System
RX Mem           : System
Test Type        : Iteration
Iterations       : 25
Write Size (B)   : 524288
Cmds per iter    : 8192
Hugepages        : Disabled
---------------------------------------------------
RDMA Size[B]      Writes  BW[Gb/s]  PktRate[Mpkt/s]
     524288       204800    188.17        11.487535
---------------------------------------------------
\f[R]
.fi
.SS Example 2
.PP
Running 10 seconds of 128KB transfers using cxi0 with GPU 0 source
memory and GPU 2 destination memory.
.IP
.nf
\f[C]
$ cxi_gpu_loopback_bw -D 10 -s 131072 --tx-gpu 0 --rx-gpu 2 -g NVIDIA
---------------------------------------------------
    CXI Loopback Bandwidth Test
Device           : cxi0
Service ID       : 1
TX Mem           : GPU 0
RX Mem           : GPU 2
GPU Type         : NVIDIA
Test Type        : Duration
Duration         : 10 seconds
Write Size (B)   : 131072
Cmds per iter    : 8192
Hugepages        : Disabled
Found 4 GPU(s)
---------------------------------------------------
RDMA Size[B]      Writes  BW[Gb/s]  PktRate[Mpkt/s]
      131072     1105920    115.88         7.072772
---------------------------------------------------
\f[R]
.fi
.SS Example 3
.PP
Running 10 seconds of 1MB transfers using cxi1 with GPU 2 source memory
and system destination memory.
.IP
.nf
\f[C]
$ cxi_gpu_loopback_bw -D 10 -d cxi1 -s 1048576 --tx-gpu 2 -g NVIDIA
---------------------------------------------------
    CXI Loopback Bandwidth Test
Device           : cxi1
Service ID       : 1
TX Mem           : GPU 2
RX Mem           : System
GPU Type         : NVIDIA
Test Type        : Duration
Duration         : 10 seconds
Write Size (B)   : 1048576
Cmds per iter    : 8192
Hugepages        : Disabled
Found 4 GPU(s)
---------------------------------------------------
RDMA Size[B]      Writes  BW[Gb/s]  PktRate[Mpkt/s]
     1048576      229376    186.02        11.353930
---------------------------------------------------
\f[R]
.fi
.SH SEE ALSO
.PP
\f[B]cxi_diags\f[R](7)
