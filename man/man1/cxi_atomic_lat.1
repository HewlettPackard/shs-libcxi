.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "CXI_ATOMIC_LAT" "1" "2023-01-30" "Version 2.0.0" "CXI Diagnostics and Utilities"
.hy
.SH NAME
.PP
cxi_atomic_lat - Cassini NIC Atomic Memory Operation latency benchmark
using LibCXI
.SH SYNOPSIS
.PP
\f[B]cxi_atomic_lat\f[R] [\f[B]-d\f[R] \f[I]DEV\f[R]] [\f[B]-p\f[R]
\f[I]PORT\f[R]]
.PD 0
.P
.PD
\f[B]cxi_atomic_lat\f[R] [\f[I]OPTIONS\f[R]] \f[I]SERVER_ADDR\f[R]
.SH DESCRIPTION
.PP
\f[B]cxi_atomic_lat\f[R] is a simple benchmark for measuring Atomic
Memory Operation (AMO) latency.
It can be configured to run a number of iterations or to run for a
duration of time.
Latency is measured for a specified atomic operation and atomic type.
Where possible, target writes are ensured to occur with every AMO.
Only client-to-server latency is measured.
.SS How to run
.PP
Two copies of the program must be launched.
The first copy is the server.
It accepts optional arguments to specify which CXI device to use and
which port to listen on for the client connection.
The second copy is the client.
It must be supplied with the hostname or IPv4 address of the server,
along with the port to connect to if the default value was not used.
The client must also be supplied with all desired run options.
.SS Output
.PP
Once a connection has been established, both the server and client print
a summary of the specified options along with the NIC fabric addresses
of both endpoints.
Only the client prints data beyond the summary.
If the \f[B]--report-all\f[R] option is used, each measured latency is
printed in two columns.
.TP
\f[I]OpNum\f[R]
The measurement number.
.TP
\f[I]Latency[us]\f[R]
The measured latency in microseconds.
Latency is measured by obtaining the time just prior to initiating an
AMO and just after receiving an acknowledgement that either the data has
been written into the target buffer, or when using fetching AMOs, when
the fetched data has been written into the initiator buffer.
These times are obtained using \f[B]clock_gettime\f[R](2).
.PP
After the benchmark runs, a latency summary is printed in six columns.
.TP
\f[I]AMO Size[B]\f[R]
The size of the AMOs.
.TP
\f[I]Ops\f[R]
The number of AMOs performed.
.TP
\f[I]Min[us]\f[R]
The smallest observed latency in microseconds.
.TP
\f[I]Max[us]\f[R]
The largest observed latency in microseconds.
.TP
\f[I]Mean[us]\f[R]
The average latency in microseconds.
.TP
\f[I]StdDev[us]\f[R]
The standard deviation of the observed latency distribution.
.SH OPTIONS
.TP
\f[B]-d, --device\f[R]=\f[I]DEV\f[R]
The Cassini NIC device name to use.
When unspecified, \[dq]cxi0\[dq] is used.
.TP
\f[B]-v, --svc-id\f[R]=\f[I]SVC_ID\f[R]
The service ID to use.
This option will be used when running as a non-privileged user.
When unspecified the default service ID is used.
.TP
\f[B]-p, --port\f[R]=\f[I]PORT\f[R]
The TCP port number to use for the client/server connection.
When unspecified, port 49194 is used.
.TP
\f[B]-n, --iters\f[R]=\f[I]ITERS\f[R]
The number of iterations to perform.
A single iteration consists of sending a single AMO and then waiting for
it to be acknowledged, or when using fetching AMOs, for its response to
be written to the initiator.
When \f[I]ITERS\f[R] and \f[I]DURATION\f[R] are both unspecified, 100
iterations are performed.
.TP
\f[B]-D, --duration\f[R]=\f[I]DURATION\f[R]
Continue running iterations until \f[I]DURATION\f[R] seconds has
elapsed.
.TP
\f[B]--warmup\f[R]=\f[I]WARMUP\f[R]
Perform \f[I]WARMUP\f[R] additional iterations and discard their latency
measurements.
By default 10 warmup iterations are performed.
.TP
\f[B]--latency-gap\f[R]=\f[I]GAP\f[R]
Wait \f[I]GAP\f[R] microseconds between each iteration.
By default the gap is 1000 microseconds.
.TP
\f[B]-A, --atomic-op\f[R]=\f[I]ATOMIC_OP\f[R]
The atomic operation to use.
When unspecified, SUM is used.
Supported ops are: MIN, MAX, SUM, LOR, LAND, BOR, BAND, LXOR, BXOR,
SWAP, CSWAP, and AXOR.
.TP
\f[B]-C, --cswap-op\f[R]=\f[I]CSWAP_OP\f[R]
The CSWAP operation to use when \f[I]ATOMIC_OP\f[R] is set to CSWAP.
When unspecified, EQ is used.
Supported ops are: EQ, NE, LE, LT, GE, and GT.
.TP
\f[B]-T, --atomic-type\f[R]=\f[I]ATOMIC_TYPE\f[R]
The atomic type to use.
When unspecified, UINT64 is used.
Supported types are: INT8, UINT8, INT16, UINT16, INT32, UINT32, INT64,
UINT64, FLOAT, DOUBLE, FLOAT_COMPLEX, DOUBLE_COMPLEX, and UINT128.
.TP
\f[B]--fetching\f[R]
Use fetching AMOs.
By default non-fetching AMOs are used.
.TP
\f[B]--matching\f[R]
Use matching list entries at the target.
By default non-matching list entries are used.
.TP
\f[B]--unrestricted\f[R]
Use unrestricted AMOs.
By default restricted AMOs are used when non-matching list entries are
used at the target.
.TP
\f[B]--no-idc\f[R]
Disable the use of Immediate Data Commands.
By default IDCs are used when non-matching list entries are used at the
target.
.TP
\f[B]--no-ll\f[R]
Disable the Low-Latency command issue mechanism.
.TP
\f[B]--report-all\f[R]
Print each latency after it is measured.
.TP
\f[B]-h, --help\f[R]
Display the help text and exit.
.TP
\f[B]-V, --version\f[R]
Display the program version and exit.
.SH EXAMPLES
.SS Example 1
.PP
Running with the default options
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_atomic_lat
Listening on port 49194 for client to connect...
-----------------------------------------------------------------------
    CXI Atomic Memory Operation Latency Test
Device           : cxi0
Test Type        : Iteration
Iterations       : 100
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Atomic Op        : NON-FETCHING SUM
Atomic Type      : UINT64
IDC              : Enabled
Matching LEs     : Disabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
-----------------------------------------------------------------------
See client for results.
-----------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_atomic_lat cxi-nid0
-----------------------------------------------------------------------
    CXI Atomic Memory Operation Latency Test
Device           : cxi0
Test Type        : Iteration
Iterations       : 100
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Atomic Op        : NON-FETCHING SUM
Atomic Type      : UINT64
IDC              : Enabled
Matching LEs     : Disabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
-----------------------------------------------------------------------
AMO Size[B]         Ops     Min[us]     Max[us]    Mean[us]  StdDev[us]
          8         100        2.48        2.63        2.50        0.06
-----------------------------------------------------------------------
\f[R]
.fi
.SS Example 2
.PP
Printing all measurements
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_atomic_lat
Listening on port 49194 for client to connect...
-----------------------------------------------------------------------
    CXI Atomic Memory Operation Latency Test
Device           : cxi0
Service ID       : 1
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Atomic Op        : FETCHING SUM
Atomic Type      : UINT64
IDC              : Enabled
Matching LEs     : Disabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
-----------------------------------------------------------------------
See client for results.
-----------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_atomic_lat cxi-nid0 --fetching --report-all -n 5
-----------------------------------------------------------------------
    CXI Atomic Memory Operation Latency Test
Device           : cxi0
Service ID       : 1
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Atomic Op        : FETCHING SUM
Atomic Type      : UINT64
IDC              : Enabled
Matching LEs     : Disabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
-----------------------------------------------------------------------
     OpNum  Latency[us]
         0        2.554
         1        2.585
         2        2.594
         3        2.565
         4        2.585
-----------------------------------------------------------------------
AMO Size[B]         Ops     Min[us]     Max[us]    Mean[us]  StdDev[us]
          8           5        2.55        2.59        2.57        0.05
-----------------------------------------------------------------------
\f[R]
.fi
.SH SEE ALSO
.PP
\f[B]cxi_diags\f[R](7)
