.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "CXI_SEND_LAT" "1" "2023-08-19" "Version 2.3.0" "CXI Diagnostics and Utilities"
.hy
.SH NAME
.PP
cxi_send_lat - Cassini NIC one-sided send latency benchmark using LibCXI
.SH SYNOPSIS
.PP
\f[B]cxi_send_lat\f[R] [\f[B]-d\f[R] \f[I]DEV\f[R]] [\f[B]-p\f[R]
\f[I]PORT\f[R]]
.PD 0
.P
.PD
\f[B]cxi_send_lat\f[R] [\f[I]OPTIONS\f[R]] \f[I]SERVER_ADDR\f[R]
.SH DESCRIPTION
.PP
\f[B]cxi_send_lat\f[R] is a simple benchmark for measuring one-sided
send latency.
It can be configured to run a number of iterations or to run for a
duration of time.
Latency is measured for a specific size of sends, or for each size
within a range.
Only client-to-server latency is measured.
Users have the option to allocate source and destination buffers from
system memory or from an available GPU device via calls to the HIP,
CUDA, or INTEL Level-zero APIs.
.SS How to run
.PP
Two copies of the program must be launched.
The first copy is the server.
It accepts optional arguments to specify which CXI device to use, which
port to listen on for the client connection, and whether or not GPU
buffers should be used.
The second copy is the client.
It must be supplied with the hostname or IPv4 address of the server,
along with the port to connect to if the default value was not used.
The client must also be supplied with all desired run options.
.SS Output
.PP
Once a connection has been established, both the server and client print
a summary of the specified options along with the NIC fabric addresses
of both endpoints.
Only the client prints data beyond the summary.
If the \f[B]--report-all\f[R] option is used, each measured latency is
printed in two columns.
.TP
\f[I]SendNum\f[R]
The measurement number.
.TP
\f[I]Latency[us]\f[R]
The measured latency in microseconds.
A message is sent first from client to server and then from server to
client.
The time is observed just prior to the client initiating a send and just
after receiving an acknowledgment signifying that the server\[cq]s echo
has been written into the client buffer.
This round-trip time is then halved to estimate one-way latency.
Times are obtained using \f[B]clock_gettime\f[R](2).
.PP
After the benchmark runs (or after each run for a range of sizes), a
latency summary is printed in six columns.
.TP
\f[I]Bytes\f[R]
The size of the send.
.TP
\f[I]Sends\f[R]
The number of sends performed.
.TP
\f[I]Min[us]\f[R]
The smallest observed latency in microseconds.
.TP
\f[I]Max[us]\f[R]
The largest observed latency in microseconds.
.TP
\f[I]Mean[us]\f[R]
The average latency in microseconds.
.TP
\f[I]StdDev[us]\f[R]
The standard deviation of the observed latency distribution.
.SH OPTIONS
.TP
\f[B]-d, --device\f[R]=\f[I]DEV\f[R]
The Cassini NIC device name to use.
When unspecified, \[dq]cxi0\[dq] is used.
.TP
\f[B]-v, --svc-id\f[R]=\f[I]SVC_ID\f[R]
The service ID to use.
This option will be used when running as a non-privileged user.
When unspecified the default service ID is used.
.TP
\f[B]-p, --port\f[R]=\f[I]PORT\f[R]
The TCP port number to use for the client/server connection.
When unspecified, port 49194 is used.
.TP
\f[B]-t, --tx-gpu\f[R]
The GPU to use for TX buffer allocation.
By default system memory is used.
.TP
\f[B]-r, --rx-gpu\f[R]
The GPU to use for RX buffer allocation.
By default system memory is used.
.TP
\f[B]-g, --gpu-type\f[R]
The GPU type to use with this test.
Valid values are AMD, NVIDIA, or INTEL.
By default the type is determined by discovered GPU files on the system.
.TP
\f[B]-n, --iters\f[R]=\f[I]ITERS\f[R]
The number of iterations to perform.
An iteration consists of sending a single send and then waiting for it
to be acknowledged.
When a range of send sizes is specified, \f[I]ITERS\f[R] iterations are
performed for each size.
When \f[I]ITERS\f[R] and \f[I]DURATION\f[R] are both unspecified, 100
iterations are performed.
.TP
\f[B]-D, --duration\f[R]=\f[I]DURATION\f[R]
Continue running iterations until \f[I]DURATION\f[R] seconds has
elapsed.
When a range of send sizes is specified, the benchmark runs for
\f[I]DURATION\f[R] seconds for each size.
.TP
\f[B]--warmup\f[R]=\f[I]WARMUP\f[R]
Perform \f[I]WARMUP\f[R] additional iterations and discard their latency
measurements.
When a range of send sizes is specified, the warmup iterations are
performed for each size.
By default 10 warmup iterations are performed.
.TP
\f[B]--latency-gap\f[R]=\f[I]GAP\f[R]
Wait \f[I]GAP\f[R] microseconds between each iteration.
By default the gap is 1000 microseconds.
.TP
\f[B]-s, --size\f[R]=\f[I]MIN\f[R][:\f[I]MAX\f[R]]
The send size, or range of sizes.
Valid send sizes are 1 through 4294697295 bytes (4GiB - 1).
When a range is specified, the benchmark runs once for each size that is
a power of two from \f[I]MIN\f[R] to \f[I]MAX\f[R].
By default the send size is 8 bytes.
.TP
\f[B]--no-idc\f[R]
Disable the use of Immediate Data Commands.
By default IDCs are used for sizes up to 224 bytes.
IDCs are disabled when TX GPU buffers are used.
.TP
\f[B]--no-ll\f[R]
Disable the Low-Latency command issue mechanism.
.TP
\f[B]-R, --rdzv\f[R]
Use rendezvous transfers.
.TP
\f[B]--report-all\f[R]
Print each latency after it is measured.
.TP
\f[B]--use-hp\f[R]=\f[I]HP_SIZE\f[R]
The size of huge pages to use when allocating the transmit and target
buffers.
This option has no effect when GPU buffers are used.
Valid values are 2M and 1G.
By default huge pages are disabled.
.TP
\f[B]-c, --clock\f[R]=\f[I]TYPE\f[R]
Clock type used to calculate latency.
Valid options are: cycles or clock_gettime.
Default is clock_gettime.
.TP
\f[B]--ignore-cpu-freq-mismatch\f[R]
Used when clock type is cycles.
Ignore CPU frequency mismatch.
Mismatch can occur when ondemand CPU frequency is enabled such as
cpufreq_ondemand governor.
.TP
\f[B]-h, --help\f[R]
Display the help text and exit.
.TP
\f[B]-V, --version\f[R]
Display the program version and exit.
.SH EXAMPLES
.SS Example 1
.PP
Running over a range of sizes for 1 second each
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_send_lat
Listening on port 49194 for client to connect...
----------------------------------------------------------------------
    CXI RDMA Send Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 100
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Min Send Size    : 1
Max Send Size    : 1024
IDC              : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
----------------------------------------------------------------------
See client for results.
----------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_send_lat 192.168.1.1 -s 1:1024
----------------------------------------------------------------------
    CXI RDMA Send Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 100
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Min Send Size    : 1
Max Send Size    : 1024
IDC              : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
----------------------------------------------------------------------
     Bytes       Sends     Min[us]     Max[us]    Mean[us]  StdDev[us]
         1         100        1.60        4.32        1.65        0.27
         2         100        1.60        1.76        1.62        0.05
         4         100        1.60        1.75        1.62        0.05
         8         100        1.60        2.65        1.64        0.13
        16         100        1.60        1.76        1.62        0.05
        32         100        1.61        1.80        1.62        0.05
        64         100        1.61        1.76        1.63        0.04
       128         100        2.20        2.36        2.22        0.06
       256         100        2.26        2.43        2.28        0.06
       512         100        2.31        4.00        2.35        0.17
      1024         100        2.41        2.58        2.43        0.04
----------------------------------------------------------------------
\f[R]
.fi
.SS Example 2
.PP
Printing all measurements
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_send_lat
Listening on port 49194 for client to connect...
----------------------------------------------------------------------
    CXI RDMA Send Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Send Size        : 8
IDC              : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
----------------------------------------------------------------------
See client for results.
----------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_send_lat 192.168.1.1 -n 5 --report-all
----------------------------------------------------------------------
    CXI RDMA Send Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Send Size        : 8
IDC              : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
----------------------------------------------------------------------
   SendNum  Latency[us]
         0        1.688
         1        1.898
         2        1.688
         3        1.693
         4        1.683
----------------------------------------------------------------------
     Bytes       Sends     Min[us]     Max[us]    Mean[us]  StdDev[us]
         8           5        1.68        1.89        1.73        0.08
----------------------------------------------------------------------
\f[R]
.fi
.SH SEE ALSO
.PP
\f[B]cxi_diags\f[R](7)
