.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "CXI_WRITE_BW" "1" "2025-08-05" "Version 2.4.0" "CXI Diagnostics and Utilities"
.hy
.SH NAME
.PP
cxi_write_bw - Cassini NIC one-sided RDMA write bandwidth benchmark
using LibCXI
.SH SYNOPSIS
.PP
\f[B]cxi_write_bw\f[R] [\f[B]-d\f[R] \f[I]DEV\f[R]] [\f[B]-p\f[R]
\f[I]PORT\f[R]]
.PD 0
.P
.PD
\f[B]cxi_write_bw\f[R] [\f[I]OPTIONS\f[R]] \f[I]SERVER_ADDR\f[R]
.SH DESCRIPTION
.PP
\f[B]cxi_write_bw\f[R] is a simple benchmark for measuring one-sided
RDMA write bandwidth.
It can be configured to run a number of iterations or to run for a
duration of time.
Bandwidth is measured for a specific size of writes, or for each size
within a range.
Either bi-directional or uni-directional bandwidth can be measured.
Users have the option to allocate source and destination buffers from
system memory or from an available GPU device via calls to the HIP,
CUDA, or INTEL Level-zero APIs.
.SS How to run
.PP
Two copies of the program must be launched.
The first copy is the server.
It accepts optional arguments to specify which CXI device to use, which
port to listen on for the client connection, and whether or not GPU
buffers should be used.
The second copy is the client.
It must be supplied with the hostname or IPv4 address of the server,
along with the port to connect to if the default value was not used.
The client must also be supplied with all desired run options.
.SS Output
.PP
Both the server and client print output, much of which is the same
between the two.
Once a connection has been established, a summary of the specified
options is printed along with the server and client NIC fabric
addresses.
After the benchmark runs (or after each run for a range of sizes), four
columns of data are printed.
.TP
\f[I]RDMA Size[B]\f[R]
The size of the RDMA writes.
.TP
\f[I]Writes\f[R]
The number of writes performed.
When measuring bi-directional bandwidth, the server and client only
report the number of writes they initiate, not the combined count.
.TP
\f[I]BW[MB/s]\f[R]
The measured bandwidth in megabytes per second.
When measuring bi-directional bandwidth, the server and client
bandwidths are combined and reported by both sides.
.TP
\f[I]PktRate[Mpkt/s]\f[R]
The measured packet rate in millions of packets per second.
When measuring bi-directional bandwidth, the server and client packet
rates are combined and reported by both sides.
Writes larger than the Portals MTU (2048 bytes) are split into multiple
packets.
.SH OPTIONS
.TP
\f[B]-d, --device\f[R]=\f[I]DEV\f[R]
The Cassini NIC device name to use.
When unspecified, \[dq]cxi0\[dq] is used.
.TP
\f[B]-v, --svc-id\f[R]=\f[I]SVC_ID\f[R]
The service ID to use.
This option will be used when running as a non-privileged user.
When unspecified the default service ID is used.
.TP
\f[B]-p, --port\f[R]=\f[I]PORT\f[R]
The TCP port number to use for the client/server connection.
When unspecified, port 49194 is used.
.TP
\f[B]-t, --tx-gpu\f[R]
The GPU to use for TX buffer allocation.
By default system memory is used.
.TP
\f[B]-r, --rx-gpu\f[R]
The GPU to use for RX buffer allocation.
By default system memory is used.
.TP
\f[B]-g, --gpu-type\f[R]
The GPU type to use with this test.
Valid values are AMD, NVIDIA, or INTEL.
By default the type is determined by discovered GPU files on the system.
.TP
\f[B]-n, --iters\f[R]=\f[I]ITERS\f[R]
The number of iterations to perform.
A single iteration consists of sending \f[I]LIST_SIZE\f[R] writes and
then waiting for each to be acknowledged.
When a range of write sizes is specified, \f[I]ITERS\f[R] iterations are
performed for each size.
When \f[I]ITERS\f[R] and \f[I]DURATION\f[R] are both unspecified, 1000
iterations are performed.
.TP
\f[B]-D, --duration\f[R]=\f[I]DURATION\f[R]
This option configures the benchmark to continue running iterations
until \f[I]DURATION\f[R] seconds has elapsed.
When a range of write sizes is specified, the benchmark runs for
\f[I]DURATION\f[R] seconds for each size.
.TP
\f[B]-s, --size\f[R]=\f[I]MIN\f[R][:\f[I]MAX\f[R]]
The write size, or range of sizes.
Valid write sizes are 1 through 4294697295 bytes (4GiB - 1).
When a range is specified, the benchmark runs once for each size that is
a power of two from \f[I]MIN\f[R] to \f[I]MAX\f[R].
By default the write size is 65536 bytes.
.TP
\f[B]-l, --list-size\f[R]=\f[I]LIST_SIZE\f[R]
The number of writes performed per iteration.
The write commands are all added to the TX command queue before ringing
the queue\[cq]s doorbell to trigger the writes.
By default the list size is 256.
.TP
\f[B]-b, --bidirectional\f[R]
This option configures the benchmark to measure bi-directional
bandwidth.
The client and server calculate their individual rates, share these with
each other, and then both report the combined rates.
By default the benchmark performs writes from the client to the server
only.
In this case, the client rates are still shared and reported from both
client and server.
Running bi-directionally works best when combined with
\f[B]--duration\f[R] rather than \f[B]--iters\f[R].
.TP
\f[B]--unrestricted\f[R]
Use unrestricted writes.
By default restricted writes are used.
.TP
\f[B]--no-hrp\f[R]
Disable the use of High Rate Puts.
By default HRPs are used for sizes up to 2048 bytes.
.TP
\f[B]--no-idc\f[R]
Disable the use of Immediate Data Commands.
By default IDCs are used for sizes up to 224 bytes for restricted writes
and up to 192 bytes for unrestricted writes.
IDCs are disabled when TX GPU buffers are used.
.TP
\f[B]--buf-sz\f[R]=\f[I]BUF_SIZE\f[R]
The maximum allowed data buffer size for both the transmit and target
buffers, specified in bytes.
The benchmark may allocate less space if it is possible to fit all
\f[I]LIST_SIZE\f[R] writes of a single iteration, without overlap,
aligned to \f[I]BUF_ALIGN\f[R] boundaries.
If \f[I]BUF_SIZE\f[R] is not a multiple of the page size, it is rounded
up to the nearest page boundary.
However, write offsets within the buffers are still chosen as if the
buffer is only \f[I]BUF_SIZE\f[R] bytes.
If the writes for a single iteration do not fit without overlap, their
offsets are wrapped around.
.TP
\f[B]--buf-align\f[R]=\f[I]BUF_ALIGN\f[R]
The alignment of writes in the transmit and target buffers.
By default this is 64 bytes.
.TP
\f[B]--use-hp\f[R]=\f[I]HP_SIZE\f[R]
The size of huge pages to use when allocating the transmit and target
buffers.
This option has no effect when GPU buffers are used.
Valid values are 2M and 1G.
By default huge pages are disabled.
.TP
\f[B]-h, --help\f[R]
Display the help text and exit.
.TP
\f[B]-V, --version\f[R]
Display the program version and exit.
.SH EXAMPLES
.SS Example 1
.PP
Running with the default options
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_write_bw
Listening on port 49194 for client to connect...
---------------------------------------------------
    CXI RDMA Write Bandwidth Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 1000
Write Size       : 65536
List Size        : 256
HRP              : Enabled
IDC              : Enabled
Restricted       : Enabled
Bidirectional    : Disabled
Max RDMA Buf     : 4294967296 (16777216 used)
RDMA Buf Align   : 64
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
---------------------------------------------------
RDMA Size[B]      Writes  BW[MB/s]  PktRate[Mpkt/s]
       65536           -  22146.94        10.813936
---------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_write_bw 10.1.1.8
---------------------------------------------------
    CXI RDMA Write Bandwidth Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 1000
Write Size       : 65536
List Size        : 256
HRP              : Enabled
IDC              : Enabled
Restricted       : Enabled
Bidirectional    : Disabled
Max RDMA Buf     : 4294967296 (16777216 used)
RDMA Buf Align   : 64
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
---------------------------------------------------
RDMA Size[B]      Writes  BW[MB/s]  PktRate[Mpkt/s]
       65536      256000  22146.94        10.813936
---------------------------------------------------
\f[R]
.fi
.SS Example 2
.PP
Running bi-directionally over a range of sizes for 5 seconds each
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_write_bw
Listening on port 49194 for client to connect...
---------------------------------------------------
    CXI RDMA Write Bandwidth Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Client RX Mem    : System
Server TX Mem    : System
Server RX Mem    : System
Test Type        : Duration
Duration         : 5 seconds
Min Write Size   : 1024
Max Write Size   : 65536
List Size        : 256
HRP              : Enabled
IDC              : Enabled
Restricted       : Enabled
Bidirectional    : Enabled
Max RDMA Buf     : 4294967296 (16777216 used)
RDMA Buf Align   : 64
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
---------------------------------------------------
RDMA Size[B]      Writes  BW[MB/s]  PktRate[Mpkt/s]
        1024    71568640  29314.66        28.627597
        2048    44694528  36613.15        17.877517
        4096    21218560  34763.74        16.974481
        8192    11737856  38461.53        18.780044
       16384     6154752  40333.92        19.694297
       32768     3153664  41334.64        20.182929
       65536     1522688  40550.70        19.800147
---------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_write_bw 10.1.1.8 -D 5 -s 1024:65536 -b
---------------------------------------------------
    CXI RDMA Write Bandwidth Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Client RX Mem    : System
Server TX Mem    : System
Server RX Mem    : System
Test Type        : Duration
Duration         : 5 seconds
Min Write Size   : 1024
Max Write Size   : 65536
List Size        : 256
HRP              : Enabled
IDC              : Enabled
Restricted       : Enabled
Bidirectional    : Enabled
Max RDMA Buf     : 4294967296 (16777216 used)
RDMA Buf Align   : 64
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
---------------------------------------------------
RDMA Size[B]      Writes  BW[MB/s]  PktRate[Mpkt/s]
        1024    71572224  29314.66        28.627597
        2048    44694272  36613.15        17.877517
        4096    21218304  34763.74        16.974481
        8192    11737856  38461.53        18.780044
       16384     6154752  40333.92        19.694297
       32768     3153664  41334.64        20.182929
       65536     1571328  40550.70        19.800147
---------------------------------------------------
\f[R]
.fi
.SH SEE ALSO
.PP
\f[B]cxi_diags\f[R](7)
