.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "CXI_WRITE_LAT" "1" "2023-08-19" "Version 2.1.0" "CXI Diagnostics and Utilities"
.hy
.SH NAME
.PP
cxi_write_lat - Cassini NIC one-sided RDMA write latency benchmark using
LibCXI
.SH SYNOPSIS
.PP
\f[B]cxi_write_lat\f[R] [\f[B]-d\f[R] \f[I]DEV\f[R]] [\f[B]-p\f[R]
\f[I]PORT\f[R]]
.PD 0
.P
.PD
\f[B]cxi_write_lat\f[R] [\f[I]OPTIONS\f[R]] \f[I]SERVER_ADDR\f[R]
.SH DESCRIPTION
.PP
\f[B]cxi_write_lat\f[R] is a simple benchmark for measuring one-sided
RDMA write latency.
It can be configured to run a number of iterations or to run for a
duration of time.
Latency is measured for a specific size of writes, or for each size
within a range.
Only client-to-server latency is measured.
Users have the option to allocate source and destination buffers from
system memory or from an available GPU device via calls to the HIP,
CUDA, or INTEL Level-zero APIs.
.SS How to run
.PP
Two copies of the program must be launched.
The first copy is the server.
It accepts optional arguments to specify which CXI device to use, which
port to listen on for the client connection, and whether or not GPU
buffers should be used.
The second copy is the client.
It must be supplied with the hostname or IPv4 address of the server,
along with the port to connect to if the default value was not used.
The client must also be supplied with all desired run options.
.SS Output
.PP
Once a connection has been established, both the server and client print
a summary of the specified options along with the NIC fabric addresses
of both endpoints.
Only the client prints data beyond the summary.
If the \f[B]--report-all\f[R] option is used, each measured latency is
printed in two columns.
.TP
\f[I]WriteNum\f[R]
The measurement number.
.TP
\f[I]Latency[us]\f[R]
The measured latency in microseconds.
Latency is measured by obtaining the time just prior to initiating a
write and just after receiving an acknowledgement signifying that the
data has been written into the target buffer.
These times are obtained using \f[B]clock_gettime\f[R](2).
.PP
After the benchmark runs (or after each run for a range of sizes), a
latency summary is printed in six columns.
.TP
\f[I]RDMA Size[B]\f[R]
The size of the RDMA writes.
.TP
\f[I]Writes\f[R]
The number of writes performed.
.TP
\f[I]Min[us]\f[R]
The smallest observed latency in microseconds.
.TP
\f[I]Max[us]\f[R]
The largest observed latency in microseconds.
.TP
\f[I]Mean[us]\f[R]
The average latency in microseconds.
.TP
\f[I]StdDev[us]\f[R]
The standard deviation of the observed latency distribution.
.SH OPTIONS
.TP
\f[B]-d, --device\f[R]=\f[I]DEV\f[R]
The Cassini NIC device name to use.
When unspecified, \[dq]cxi0\[dq] is used.
.TP
\f[B]-v, --svc-id\f[R]=\f[I]SVC_ID\f[R]
The service ID to use.
This option will be used when running as a non-privileged user.
When unspecified the default service ID is used.
.TP
\f[B]-p, --port\f[R]=\f[I]PORT\f[R]
The TCP port number to use for the client/server connection.
When unspecified, port 49194 is used.
.TP
\f[B]-t, --tx-gpu\f[R]
The GPU to use for TX buffer allocation.
By default system memory is used.
.TP
\f[B]-r, --rx-gpu\f[R]
The GPU to use for RX buffer allocation.
By default system memory is used.
.TP
\f[B]-g, --gpu-type\f[R]
The GPU type to use with this test.
Valid values are AMD, NVIDIA, or INTEL.
By default the type is determined by discovered GPU files on the system.
.TP
\f[B]-n, --iters\f[R]=\f[I]ITERS\f[R]
The number of iterations to perform.
An iteration consists of sending a single write and then waiting for it
to be acknowledged.
When a range of write sizes is specified, \f[I]ITERS\f[R] iterations are
performed for each size.
When \f[I]ITERS\f[R] and \f[I]DURATION\f[R] are both unspecified, 100
iterations are performed.
.TP
\f[B]-D, --duration\f[R]=\f[I]DURATION\f[R]
Continue running iterations until \f[I]DURATION\f[R] seconds has
elapsed.
When a range of write sizes is specified, the benchmark runs for
\f[I]DURATION\f[R] seconds for each size.
.TP
\f[B]--warmup\f[R]=\f[I]WARMUP\f[R]
Perform \f[I]WARMUP\f[R] additional iterations and discard their latency
measurements.
When a range of write sizes is specified, the warmup iterations are
performed for each size.
By default 10 warmup iterations are performed.
.TP
\f[B]--latency-gap\f[R]=\f[I]GAP\f[R]
Wait \f[I]GAP\f[R] microseconds between each iteration.
By default the gap is 1000 microseconds.
.TP
\f[B]-s, --size\f[R]=\f[I]MIN\f[R][:\f[I]MAX\f[R]]
The write size, or range of sizes.
Valid write sizes are 1 through 4294697295 bytes (4GiB - 1).
When a range is specified, the benchmark runs once for each size that is
a power of two from \f[I]MIN\f[R] to \f[I]MAX\f[R].
By default the write size are 8 bytes.
.TP
\f[B]--unrestricted\f[R]
Use unrestricted writes.
By default restricted writes are used.
.TP
\f[B]--no-idc\f[R]
Disable the use of Immediate Data Commands.
By default IDCs are used for sizes up to 224 bytes for restricted writes
and up to 192 bytes for unrestricted writes.
IDCs are disabled when TX GPU buffers are used.
.TP
\f[B]--no-ll\f[R]
Disable the Low-Latency command issue mechanism.
.TP
\f[B]--report-all\f[R]
Print each latency after it is measured.
.TP
\f[B]--use-hp\f[R]=\f[I]HP_SIZE\f[R]
The size of huge pages to use when allocating the transmit and target
buffers.
This option has no effect when GPU buffers are used.
Valid values are 2M and 1G.
By default huge pages are disabled.
.TP
\f[B]-h, --help\f[R]
Display the help text and exit.
.TP
\f[B]-V, --version\f[R]
Display the program version and exit.
.SH EXAMPLES
.SS Example 1
.PP
Running over a range of sizes for 1 second each
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_write_lat
Listening on port 49194 for client to connect...
------------------------------------------------------------------------
    CXI RDMA Write Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Duration
Duration         : 1 seconds
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Min Write Size   : 1
Max Write Size   : 1024
IDC              : Enabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
------------------------------------------------------------------------
See client for results.
------------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_write_lat 10.1.1.8 -D 1 -s 1:1024
------------------------------------------------------------------------
    CXI RDMA Write Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Duration
Duration         : 1 seconds
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Min Write Size   : 1
Max Write Size   : 1024
IDC              : Enabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : Summary
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
------------------------------------------------------------------------
RDMA Size[B]      Writes     Min[us]     Max[us]    Mean[us]  StdDev[us]
           1      103477        2.04        7.65        2.08        0.06
           2      103468        2.04        4.64        2.08        0.06
           4      103542        2.03        3.56        2.07        0.05
           8      103527        2.02       22.99        2.07        0.09
          16      103460        2.04        5.37        2.08        0.05
          32      103447        2.04       80.47        2.08        0.24
          64      103341        2.05        4.68        2.09        0.04
         128       97339        2.63        6.83        2.69        0.07
         256       96814        2.69        4.16        2.74        0.02
         512       96490        2.72        6.34        2.78        0.06
        1024       95714        2.81        6.56        2.86        0.05
------------------------------------------------------------------------
\f[R]
.fi
.SS Example 2
.PP
Printing all measurements
.PP
\f[I]Server\f[R]
.IP
.nf
\f[C]
$ cxi_write_lat
Listening on port 49194 for client to connect...
------------------------------------------------------------------------
    CXI RDMA Write Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Write Size       : 8
IDC              : Enabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Hugepages        : Disabled
Local (server)   : NIC 0x12 PID 0 VNI 10
Remote (client)  : NIC 0x13 PID 0
------------------------------------------------------------------------
See client for results.
------------------------------------------------------------------------
\f[R]
.fi
.PP
\f[I]Client\f[R]
.IP
.nf
\f[C]
$ cxi_write_lat 10.1.1.8 -n 5 --report-all
------------------------------------------------------------------------
    CXI RDMA Write Latency Test
Device           : cxi0
Service ID       : 1
Client TX Mem    : System
Server RX Mem    : System
Test Type        : Iteration
Iterations       : 5
Warmup Iters     : 10
Inter-Iter Gap   : 1000 microseconds
Write Size       : 8
IDC              : Enabled
Restricted       : Enabled
LL Cmd Launch    : Enabled
Results Reported : All
Hugepages        : Disabled
Local (client)   : NIC 0x13 PID 0 VNI 10
Remote (server)  : NIC 0x12 PID 0
------------------------------------------------------------------------
  WriteNum  Latency[us]
         0        2.008
         1        2.012
         2        2.008
         3        2.007
         4        2.008
------------------------------------------------------------------------
RDMA Size[B]      Writes     Min[us]     Max[us]    Mean[us]  StdDev[us]
           8           5        2.07        2.12        2.09        0.01
------------------------------------------------------------------------
\f[R]
.fi
.SH SEE ALSO
.PP
\f[B]cxi_diags\f[R](7)
